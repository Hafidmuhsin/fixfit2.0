{% extends 'base.html' %}

{% block content %}
<div x-data="{ activeModal: null, waterAmount: 250 }" class="relative">

    <!-- Dashboard Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">

        <!-- Sidebar / User Profile -->
        <div class="lg:col-span-1 space-y-8">
            <!-- Profile Card -->
            <div
                class="bg-white/5 backdrop-blur-xl rounded-3xl p-6 border border-white/10 shadow-2xl relative overflow-hidden group">
                <div
                    class="absolute top-0 right-0 w-32 h-32 bg-purple-500/20 rounded-full blur-3xl -mr-16 -mt-16 transition-all duration-700 group-hover:bg-purple-500/30">
                </div>

                <div class="flex items-center space-x-4 mb-6 relative z-10">
                    <div class="w-16 h-16 rounded-full bg-gradient-to-tr from-cyan-400 to-blue-600 p-1">
                        <img src="https://ui-avatars.com/api/?name={{ user.username }}&background=0D8ABC&color=fff"
                            alt="User" class="w-full h-full rounded-full border-2 border-gray-900 object-cover">
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-white">{{ user.first_name|default:user.username }}</h2>
                        <button @click="activeModal = 'goals'"
                            class="text-xs text-cyan-400 hover:text-cyan-300 flex items-center mt-1">
                            <span>Edit Goals</span>
                            <svg class="w-3 h-3 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z">
                                </path>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="space-y-3">
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-400">Current Weight</span>
                        <span class="font-semibold text-white">{{ user.weight|default:"--" }} kg</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-400">Target Weight</span>
                        <span class="font-semibold text-cyan-400">{{ goal.target_weight|default:"--" }} kg</span>
                    </div>
                </div>
            </div>

            <!-- Quick Log Buttons -->
            <div class="bg-white/5 backdrop-blur-xl rounded-3xl p-6 border border-white/10 shadow-lg">
                <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                    <svg class="w-5 h-5 mr-2 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    Quick Log
                </h3>
                <div class="grid grid-cols-2 gap-3">
                    <button @click="activeModal = 'food'"
                        class="flex flex-col items-center justify-center p-4 rounded-2xl bg-white/5 hover:bg-white/10 transition-colors border border-white/5 group">
                        <span class="text-2xl mb-1 group-hover:scale-110 transition-transform">üçé</span>
                        <span class="text-xs font-medium text-gray-300">Food</span>
                    </button>
                    <button @click="activeModal = 'water'"
                        class="flex flex-col items-center justify-center p-4 rounded-2xl bg-white/5 hover:bg-white/10 transition-colors border border-white/5 group">
                        <span class="text-2xl mb-1 group-hover:scale-110 transition-transform">üíß</span>
                        <span class="text-xs font-medium text-gray-300">Water</span>
                    </button>
                    <button @click="activeModal = 'exercise'"
                        class="flex flex-col items-center justify-center p-4 rounded-2xl bg-white/5 hover:bg-white/10 transition-colors border border-white/5 group">
                        <span class="text-2xl mb-1 group-hover:scale-110 transition-transform">üèãÔ∏è</span>
                        <span class="text-xs font-medium text-gray-300">Workout</span>
                    </button>
                    <button @click="activeModal = 'sleep'"
                        class="flex flex-col items-center justify-center p-4 rounded-2xl bg-white/5 hover:bg-white/10 transition-colors border border-white/5 group">
                        <span class="text-2xl mb-1 group-hover:scale-110 transition-transform">üò¥</span>
                        <span class="text-xs font-medium text-gray-300">Sleep</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Area -->
        <div class="lg:col-span-3 space-y-8">
            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Calories -->
                <div
                    class="bg-gray-800/50 backdrop-blur-md rounded-3xl p-6 border border-white/5 relative overflow-hidden">
                    <h3 class="text-gray-400 text-sm font-medium uppercase tracking-wider mb-1">Calories Remaining</h3>
                    <div class="flex items-baseline space-x-2">
                        <span class="text-4xl font-bold text-white">{{ remaining_calories }}</span>
                        <span class="text-sm text-gray-500">kcal left</span>
                    </div>
                    <div class="mt-4 w-full bg-gray-700/50 rounded-full h-2">
                        <div class="bg-gradient-to-r from-orange-400 to-red-500 h-2 rounded-full transition-all duration-1000"
                            style="width: {{ cal_percent }}%"></div>
                    </div>
                    <p class="text-xs text-gray-400 mt-2 flex justify-between">
                        <span>Eaten: {{ calories_in }}</span>
                        <span class="text-green-400">Burned: {{ calories_out }}</span>
                        <span>Goal: {{ goal.daily_calories }}</span>
                    </p>
                </div>

                <!-- Water -->
                <div
                    class="bg-gray-800/50 backdrop-blur-md rounded-3xl p-6 border border-white/5 relative overflow-hidden">
                    <h3 class="text-gray-400 text-sm font-medium uppercase tracking-wider mb-1">Hydration</h3>
                    <div class="flex items-baseline space-x-2">
                        <span class="text-4xl font-bold text-white">{{ water_ml }}</span>
                        <span class="text-sm text-gray-500">/ {{ goal.daily_water_ml }} ml</span>
                    </div>
                    <div class="mt-4 w-full bg-gray-700/50 rounded-full h-2">
                        <div class="bg-gradient-to-r from-cyan-400 to-blue-600 h-2 rounded-full transition-all duration-1000"
                            style="width: {{ water_percent }}%"></div>
                    </div>
                </div>

                <!-- Sleep -->
                <div
                    class="bg-gray-800/50 backdrop-blur-md rounded-3xl p-6 border border-white/5 relative overflow-hidden">
                    <h3 class="text-gray-400 text-sm font-medium uppercase tracking-wider mb-1">Sleep</h3>
                    <div class="flex items-baseline space-x-2">
                        <span class="text-4xl font-bold text-white">{{ sleep_hours_display }}</span>
                        <span class="text-sm text-gray-500">/ {{ goal.daily_sleep_hours }}h</span>
                    </div>
                    <div class="mt-4 w-full bg-gray-700/50 rounded-full h-2">
                        <div class="bg-gradient-to-r from-purple-400 to-indigo-600 h-2 rounded-full transition-all duration-1000"
                            style="width: {{ sleep_percent }}%"></div>
                    </div>
                </div>
            </div>

            <!-- Trends Chart -->
            <div class="bg-gray-800/50 backdrop-blur-md rounded-3xl p-6 border border-white/5 shadow-lg relative mb-8"
                x-data="{ currentTab: 'calories' }">
                <div class="flex flex-col md:flex-row items-center justify-between mb-6 space-y-4 md:space-y-0">
                    <h3 class="text-xl font-bold text-white">Health Trends (Last 7 Days)</h3>

                    <!-- Tabs -->
                    <div class="flex space-x-2 bg-black/20 p-1 rounded-xl">
                        <button @click="currentTab = 'calories'; updateChart('calories')"
                            :class="{ 'bg-orange-500 text-white shadow-lg': currentTab === 'calories', 'text-gray-400 hover:text-white': currentTab !== 'calories' }"
                            class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-300">Calories</button>

                        <button @click="currentTab = 'water'; updateChart('water')"
                            :class="{ 'bg-blue-500 text-white shadow-lg': currentTab === 'water', 'text-gray-400 hover:text-white': currentTab !== 'water' }"
                            class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-300">Water</button>

                        <button @click="currentTab = 'sleep'; updateChart('sleep')"
                            :class="{ 'bg-purple-500 text-white shadow-lg': currentTab === 'sleep', 'text-gray-400 hover:text-white': currentTab !== 'sleep' }"
                            class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-300">Sleep</button>
                    </div>
                </div>

                <div class="relative h-64 w-full">
                    <canvas id="healthChart"></canvas>
                </div>
            </div>

            <!-- Recent Interactions Table -->
            <div class="bg-gray-800/30 backdrop-blur-xl rounded-3xl p-8 border border-white/5 shadow-2xl">
                <h3 class="text-xl font-bold text-white mb-6">Today's Activity</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm text-gray-400">
                        <thead class="text-xs uppercase text-gray-500 border-b border-gray-700">
                            <tr>
                                <th class="pb-3">Activity / Food</th>
                                <th class="pb-3 text-right">Value</th>
                                <th class="pb-3 text-right">Time</th>
                                <th class="pb-3 w-10"></th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-700/50">
                            {% for log in recent_exercise %}
                            <tr class="group hover:bg-white/5 transition-colors">
                                <td class="py-3 flex items-center text-green-400"><span class="mr-2">üèãÔ∏è</span> {{
                                    log.activity_name }}</td>
                                <td class="py-3 text-right">-{{ log.calories_burned }} kcal</td>
                                <td class="py-3 text-right">{{ log.created_at|date:"H:i" }}</td>
                                <td class="py-3 text-right opacity-0 group-hover:opacity-100 transition-opacity">
                                    <form action="{% url 'delete_log' 'exercise' log.id %}" method="POST"
                                        class="inline">
                                        {% csrf_token %}
                                        <button type="submit" class="text-gray-600 hover:text-red-500 transition-colors"
                                            title="Delete">‚úï</button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}

                            {% for log in recent_cals %}
                            <tr class="group hover:bg-white/5 transition-colors">
                                <td class="py-3 flex items-center text-orange-400"><span class="mr-2">üçé</span> {{
                                    log.food_name }}</td>
                                <td class="py-3 text-right">+{{ log.calories }} kcal</td>
                                <td class="py-3 text-right">{{ log.created_at|date:"H:i" }}</td>
                                <td class="py-3 text-right opacity-0 group-hover:opacity-100 transition-opacity">
                                    <form action="{% url 'delete_log' 'food' log.id %}" method="POST" class="inline">
                                        {% csrf_token %}
                                        <button type="submit" class="text-gray-600 hover:text-red-500 transition-colors"
                                            title="Delete">‚úï</button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}

                            {% for log in recent_water %}
                            <tr class="group hover:bg-white/5 transition-colors">
                                <td class="py-3 flex items-center text-blue-400"><span class="mr-2">üíß</span> Water</td>
                                <td class="py-3 text-right">+{{ log.amount_ml }} ml</td>
                                <td class="py-3 text-right">{{ log.created_at|date:"H:i" }}</td>
                                <td class="py-3 text-right opacity-0 group-hover:opacity-100 transition-opacity">
                                    <form action="{% url 'delete_log' 'water' log.id %}" method="POST" class="inline">
                                        {% csrf_token %}
                                        <button type="submit" class="text-gray-600 hover:text-red-500 transition-colors"
                                            title="Delete">‚úï</button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}

                            {% if not recent_cals and not recent_water and not recent_exercise %}
                            <tr>
                                <td colspan="4" class="py-8 text-center text-gray-600 italic">No activity yet. Start
                                    logging!</td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS -->

    <!-- 1. Add Food Modal -->
    <div x-show="activeModal === 'food'"
        class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm"
        style="display: none;">
        <div @click.away="activeModal = null"
            class="bg-gray-900 border border-white/10 rounded-2xl p-8 w-full max-w-md relative">
            <h3 class="text-xl font-bold text-white mb-6">Log Food</h3>
            <form action="{% url 'log_food' %}" method="POST" class="space-y-4">
                {% csrf_token %}
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Select Food</label>
                    <select name="food_id"
                        class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:ring-cyan-500">
                        <option value="">-- Choose from Database --</option>
                        {% for item in today_food_items %}
                        <option value="{{ item.id }}">{{ item.name }} ({{ item.calories }} kcal)</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="text-center text-gray-500 text-xs">- OR -</div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Custom Food Name</label>
                    <input type="text" name="custom_name" placeholder="e.g. Grandma's Pie"
                        class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Calories</label>
                    <input type="number" name="calories" placeholder="e.g. 450"
                        class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white">
                </div>
                <button type="submit" class="w-full btn-primary py-3 rounded-xl mt-4">Add to Log</button>
            </form>
            <button @click="activeModal = null" class="absolute top-4 right-4 text-gray-500 hover:text-white">‚úï</button>
        </div>
    </div>

    <!-- 2. Add Water Modal -->
    <div x-show="activeModal === 'water'"
        class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm"
        style="display: none;">
        <div @click.away="activeModal = null"
            class="bg-gray-900 border border-white/10 rounded-2xl p-8 w-full max-w-sm relative">
            <h3 class="text-xl font-bold text-white mb-6">Log Water</h3>
            <div class="grid grid-cols-2 gap-4 mb-6">
                <form action="{% url 'log_water' %}" method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="amount" value="250">
                    <button type="submit"
                        class="w-full py-4 bg-blue-500/10 border border-blue-500/30 rounded-xl text-blue-400 hover:bg-blue-500/20 transition-colors">
                        <span class="text-2xl block mb-1">ü•õ</span>
                        <span class="text-sm font-bold">+250ml</span>
                    </button>
                </form>
                <form action="{% url 'log_water' %}" method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="amount" value="500">
                    <button type="submit"
                        class="w-full py-4 bg-blue-500/10 border border-blue-500/30 rounded-xl text-blue-400 hover:bg-blue-500/20 transition-colors">
                        <span class="text-2xl block mb-1">üß¥</span>
                        <span class="text-sm font-bold">+500ml</span>
                    </button>
                </form>
            </div>
            <form action="{% url 'log_water' %}" method="POST" class="mt-4">
                {% csrf_token %}
                <label class="block text-sm text-gray-400 mb-1">Custom Amount (ml)</label>
                <div class="flex space-x-2">
                    <input type="number" name="amount" placeholder="e.g. 330"
                        class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white">
                    <button type="submit"
                        class="px-6 bg-blue-600 rounded-lg text-white font-bold hover:bg-blue-500">Add</button>
                </div>
            </form>
            <button @click="activeModal = null" class="absolute top-4 right-4 text-gray-500 hover:text-white">‚úï</button>
        </div>
    </div>

    <!-- 3. Add Exercise Modal -->
    <div x-show="activeModal === 'exercise'"
        class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm"
        style="display: none;">
        <div @click.away="activeModal = null"
            class="bg-gray-900 border border-white/10 rounded-2xl p-8 w-full max-w-md relative">
            <h3 class="text-xl font-bold text-white mb-6">Log Workout</h3>
            <form action="{% url 'log_exercise' %}" method="POST" class="space-y-4">
                {% csrf_token %}
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Activity Type</label>
                    <select name="exercise_type"
                        class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white">
                        <option value="">-- Custom --</option>
                        {% for ex in exercise_types %}
                        <option value="{{ ex.id }}">{{ ex.name }} (~{{ ex.calories_per_hour }} cal/hr)</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Duration (minutes)</label>
                    <input type="number" name="duration" value="30"
                        class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Intensity</label>
                    <select name="intensity"
                        class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white">
                        <option>Low</option>
                        <option selected>Medium</option>
                        <option>High</option>
                    </select>
                </div>
                <button type="submit" class="w-full btn-primary py-3 rounded-xl mt-4">Log Workout</button>
            </form>
            <button @click="activeModal = null" class="absolute top-4 right-4 text-gray-500 hover:text-white">‚úï</button>
        </div>
    </div>

    <!-- 4. Sleep Modal -->
    <div x-show="activeModal === 'sleep'"
        class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm"
        style="display: none;">
        <div @click.away="activeModal = null"
            class="bg-gray-900 border border-white/10 rounded-2xl p-8 w-full max-w-sm relative">
            <h3 class="text-xl font-bold text-white mb-6">Log Sleep</h3>
            <form action="{% url 'log_sleep' %}" method="POST" class="space-y-4">
                {% csrf_token %}
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Hours Slept</label>
                    <input type="number" step="0.5" name="hours" placeholder="8.0"
                        class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white"
                        @input="$refs.mins.value = $event.target.value * 60">
                    <input type="hidden" name="duration" x-ref="mins" value="480">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Quality (1-10)</label>
                    <input type="range" name="quality" min="1" max="10" value="7" class="w-full accent-purple-500">
                    <div class="flex justify-between text-xs text-gray-500 px-1">
                        <span>Awful</span>
                        <span>Perfect</span>
                    </div>
                </div>
                <button type="submit" class="w-full btn-primary py-3 rounded-xl mt-4">Log Sleep</button>
            </form>
            <button @click="activeModal = null" class="absolute top-4 right-4 text-gray-500 hover:text-white">‚úï</button>
        </div>
    </div>

    <!-- 5. Edit Goals Modal -->
    <div x-show="activeModal === 'goals'"
        class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm"
        style="display: none;">
        <div @click.away="activeModal = null"
            class="bg-gray-900 border border-white/10 rounded-2xl p-8 w-full max-w-md relative">
            <h3 class="text-xl font-bold text-white mb-6">Update Targets</h3>
            <form action="{% url 'update_goals' %}" method="POST" class="space-y-4">
                {% csrf_token %}
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs text-gray-400 mb-1 uppercase">Daily Calories</label>
                        <input type="number" name="daily_calories" value="{{ goal.daily_calories }}"
                            class="w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-white">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-400 mb-1 uppercase">Water (ml)</label>
                        <input type="number" name="daily_water_ml" value="{{ goal.daily_water_ml }}"
                            class="w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-white">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-400 mb-1 uppercase">Sleep (Hours)</label>
                        <input type="number" step="0.1" name="daily_sleep_hours" value="{{ goal.daily_sleep_hours }}"
                            class="w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-white">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-400 mb-1 uppercase">Target Weight</label>
                        <input type="number" step="0.1" name="target_weight" value="{{ goal.target_weight|default:'' }}"
                            class="w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-white">
                    </div>
                </div>
                <button type="submit" class="w-full btn-primary py-3 rounded-xl mt-4">Save Goals</button>
            </form>
            <button @click="activeModal = null" class="absolute top-4 right-4 text-gray-500 hover:text-white">‚úï</button>
        </div>
    </div>

</div>
{% endblock %}

{% block extra_js %}
<script>
    let chartInstance = null;
    let apiData = null;

    async function fetchChartData() {
        try {
            const response = await fetch("{% url 'chart_data' %}");
            if (!response.ok) throw new Error('Network response was not ok');
            apiData = await response.json();
            updateChart('calories'); // Default
        } catch (error) {
            console.error('Error fetching chart data:', error);
        }
    }

    function updateChart(type) {
        if (!apiData) return;

        const ctx = document.getElementById('healthChart').getContext('2d');

        // Colors
        const colors = {
            'calories': { border: '#f97316', bg: 'rgba(249, 115, 22, 0.2)' }, // Orange-500
            'water': { border: '#06b6d4', bg: 'rgba(6, 182, 212, 0.2)' },    // Cyan-500
            'sleep': { border: '#8b5cf6', bg: 'rgba(139, 92, 246, 0.2)' }    // Violet-500
        };

        const config = colors[type];
        const data = apiData[type];
        const labels = apiData.labels; // Labels are common across types

        if (chartInstance) {
            chartInstance.destroy();
        }

        // Gradient for fill
        const gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, config.bg);
        gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');

        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: type.charAt(0).toUpperCase() + type.slice(1),
                    data: data,
                    borderColor: config.border,
                    backgroundColor: gradient,
                    borderWidth: 3,
                    tension: 0.4, // Smooth curves
                    fill: true,
                    pointBackgroundColor: '#1f2937', // Gray-800
                    pointBorderColor: config.border,
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        borderColor: 'rgba(255, 255, 255, 0.1)',
                        borderWidth: 1,
                        padding: 10,
                        displayColors: false,
                        callbacks: {
                            label: function (context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    if (type === 'water') label += context.parsed.y + ' ml';
                                    else if (type === 'calories') label += context.parsed.y + ' kcal';
                                    else label += context.parsed.y + ' hrs';
                                }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: { display: false, drawBorder: false },
                        ticks: { color: '#9ca3af', font: { family: 'Inter' } }
                    },
                    y: {
                        grid: { color: 'rgba(255, 255, 255, 0.05)', drawBorder: false },
                        ticks: { color: '#9ca3af', font: { family: 'Inter' } },
                        beginAtZero: true
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index',
                },
            }
        });
    }

    document.addEventListener('DOMContentLoaded', fetchChartData);
</script>
{% endblock %}